name: deta PP下载alist上传
on:
  repository_dispatch:
  workflow_dispatch:
    inputs:
      Folder:
        description: '保存目录'
        required: true
        default: '202312'

jobs:
  Aria2-Aliyun:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
          persist-credentials: false # otherwise, the token used is the GITHUB_TOKEN, instead of your personal token
          fetch-depth: 0 
      - name: gengxing
        run: |
           sudo apt-get update          
      - name: 检查空间使用情况
        run: |
          echo "Free space:"
          df -h


         
      - name: 安装Aria2 1
        run: sudo apt install -y aria2     
      - name: 安装Python3.9
        uses: actions/setup-python@v2
        with:
          python-version: 3.9
      - name: 安装所需要的Python信赖 1
        run: |
          python -m pip install --upgrade pip wheel    
          pip install install requests   

      - name: 下载文件1
        id: downloading1
        run: |
          mkdir downloads
          python task.py --projet="${{ secrets.DETA_PROJECT_ID }}" --apikey="${{ secrets.DETA_API_KEY }}" --act="download"
          filename=$(ls downloads | head -n1)    
          echo "::set-output name=path::downloads/$filename"    
          echo "::set-output name=filename::$filename"    
          echo "::set-output name=taskkey::$taskkey"    
          size=$(ls -l downloads/$filename | awk '{print $5}' )    
          echo "::set-output name=size::$size"  

      - name: 下载加密程序1
        run: |
          curl -L -o dist.tar.gz https://github.com/githubdesktopaa/alist-encrypt/releases/download/0.0.2/dist.tar.gz
          tar -xzf dist.tar.gz
      - name: 下载加密程序1
        run: |
           cd ${{ github.workspace }}/dist.tar/
           tar -xzf dist.tar
          
      - name: crypt file
        id: encrypt1
        run: |
           ${{ github.workspace }}/dist.tar/dist/build/nodejs-linux '${{ secrets.ALIST_ENCRYPT_PASSWORD }}' aesctr enc '${{ github.workspace }}/downloads/' '${{ github.workspace }}/out/' encName
           filename=$(ls out | head -n1)
           sha1_s=`openssl sha1 out/$filename | awk '{ print $2 }'`
           header="OC-Checksum:sha1:$sha1_s"
           echo "::set-output name=header::$header"
           echo "::set-output name=filename::$filename"
           echo "::set-output name=path::out/$filename"
           size=$(ls -l out/$filename | awk '{print $5}' )
           echo "::set-output name=size::$size"

      - name: 上传OneDrive1
        uses: wei/rclone@v1
        env:
          RCLONE_CONF: ${{ secrets.RCLONE_CONF }}
        with:
          args: copy out/  ${{ secrets.TO_UPLOAD_TO_THE_NETDISK_ONEDRIVE }}:${{ secrets.YEARS }}/${{ secrets.VIDEO_PP_SAVE_DIRECTORY }}  ${{ secrets.RCLONE_UPLOAD_CONFIGURATION_PARAMETERS }}

      - name: 保存数据，删除远程已经下载列表1
        id:  database
        if: steps.encrypt.outputs.filename != '' && !cancelled() && !failure()
        run: |
          python task.py --projet="${{ secrets.DETA_PROJECT_ID }}" --apikey="${{ secrets.DETA_API_KEY }}" --taskkey="${{ steps.downloading1.outputs.taskkey }}" --act="del"
          echo "::set-output name=status::ok"
      - name: 第1次删除已下载文件
        run: |
         sudo rm -rf downloads
         sudo rm -rf out

      - name: 第2次安装Aria2
        run: sudo apt install -y aria2     
      - name: 第2次安装Python3.9
        uses: actions/setup-python@v2
        with:
          python-version: 3.9
      - name: 第2次安装所需要的Python信赖
        run: |
          python -m pip install --upgrade pip wheel    
          pip install install requests    

      - name: 第2次下载文件
        id: downloading2
        run: |
          mkdir downloads
          python task.py --projet="${{ secrets.DETA_PROJECT_ID }}" --apikey="${{ secrets.DETA_API_KEY }}" --act="download"
          filename=$(ls downloads | head -n1)    
          echo "::set-output name=path::downloads/$filename"    
          echo "::set-output name=filename::$filename"    
          echo "::set-output name=taskkey::$taskkey"    
          size=$(ls -l downloads/$filename | awk '{print $5}' )    
          echo "::set-output name=size::$size"    

      - name: 下载加密程序2
        run: |
          curl -L -o dist.tar.gz https://github.com/githubdesktopaa/alist-encrypt/releases/download/0.0.2/dist.tar.gz
          tar -xzf dist.tar.gz
          
      - name: crypt file
        id: encrypt2
        run: |
           ${{ github.workspace }}/dist.tar/dist/build/nodejs-linux '${{ secrets.ALIST_ENCRYPT_PASSWORD }}' aesctr enc '${{ github.workspace }}/downloads/' '${{ github.workspace }}/out/' encName
           filename=$(ls out | head -n1)
           sha1_s=`openssl sha1 out/$filename | awk '{ print $2 }'`
           header="OC-Checksum:sha1:$sha1_s"
           echo "::set-output name=header::$header"
           echo "::set-output name=filename::$filename"
           echo "::set-output name=path::out/$filename"
           size=$(ls -l out/$filename | awk '{print $5}' )
           echo "::set-output name=size::$size"          
          
      
      - name: 第2次上传OneDrive
        uses: wei/rclone@v1
        env:
          RCLONE_CONF: ${{ secrets.RCLONE_CONF }}
        with:
          args: copy out/  ${{ secrets.TO_UPLOAD_TO_THE_NETDISK_ONEDRIVE }}:${{ secrets.YEARS }}/${{ secrets.VIDEO_PP_SAVE_DIRECTORY }}  ${{ secrets.RCLONE_UPLOAD_CONFIGURATION_PARAMETERS }}  
      
      - name: 第2次保存数据，删除远程已经下载列表
        id:  database2
        run: |
          python task.py --projet="${{ secrets.DETA_PROJECT_ID }}" --apikey="${{ secrets.DETA_API_KEY }}" --taskkey="${{ steps.downloading2.outputs.taskkey }}" --act="del"
          echo "::set-output name=status::ok"
      - name: 第2次删除已下载文件
        run: |
         sudo rm -rf downloads
         sudo rm -rf out

      - name: 第3次安装Aria2
        run: sudo apt install -y aria2     
      - name: 第3次安装Python3.9
        uses: actions/setup-python@v2
        with:
          python-version: 3.9
      - name: 第3次安装所需要的Python信赖
        run: |
          python -m pip install --upgrade pip wheel    
          pip install install requests    

      - name: 第3次下载文件
        id: downloading3
        run: |
          mkdir downloads
          python task.py --projet="${{ secrets.DETA_PROJECT_ID }}" --apikey="${{ secrets.DETA_API_KEY }}" --act="download"
          filename=$(ls downloads | head -n1)    
          echo "::set-output name=path::downloads/$filename"    
          echo "::set-output name=filename::$filename"    
          echo "::set-output name=taskkey::$taskkey"    
          size=$(ls -l downloads/$filename | awk '{print $5}' )    
          echo "::set-output name=size::$size"    

      - name: 下载加密程序3
        run: |
          curl -L -o dist.tar.gz https://github.com/githubdesktopaa/alist-encrypt/releases/download/0.0.2/dist.tar.gz
          tar -xzf dist.tar.gz
          
      - name: crypt file
        id: encrypt3
        run: |
           ${{ github.workspace }}/dist.tar/dist/build/nodejs-linux '${{ secrets.ALIST_ENCRYPT_PASSWORD }}' aesctr enc '${{ github.workspace }}/downloads/' '${{ github.workspace }}/out/' encName
           filename=$(ls out | head -n1)
           sha1_s=`openssl sha1 out/$filename | awk '{ print $2 }'`
           header="OC-Checksum:sha1:$sha1_s"
           echo "::set-output name=header::$header"
           echo "::set-output name=filename::$filename"
           echo "::set-output name=path::out/$filename"
           size=$(ls -l out/$filename | awk '{print $5}' )
           echo "::set-output name=size::$size"          
          
      
      - name: 第3次上传OneDrive
        uses: wei/rclone@v1
        env:
          RCLONE_CONF: ${{ secrets.RCLONE_CONF }}
        with:
          args: copy out/  ${{ secrets.TO_UPLOAD_TO_THE_NETDISK_ONEDRIVE }}:${{ secrets.YEARS }}/${{ secrets.VIDEO_PP_SAVE_DIRECTORY }}  ${{ secrets.RCLONE_UPLOAD_CONFIGURATION_PARAMETERS }}  
      
      - name: 第3次保存数据，删除远程已经下载列表
        id:  database3
        run: |
          python task.py --projet="${{ secrets.DETA_PROJECT_ID }}" --apikey="${{ secrets.DETA_API_KEY }}" --taskkey="${{ steps.downloading3.outputs.taskkey }}" --act="del"
          echo "::set-output name=status::ok"
      - name: 第3次删除已下载文件
        run: |
         sudo rm -rf downloads
         sudo rm -rf out


      - name: 第4次安装Aria2
        run: sudo apt install -y aria2     
      - name: 第4次安装Python3.9
        uses: actions/setup-python@v2
        with:
          python-version: 3.9
      - name: 第4次安装所需要的Python信赖
        run: |
          python -m pip install --upgrade pip wheel    
          pip install install requests    

      - name: 第4次下载文件
        id: downloading4
        run: |
          mkdir downloads
          python task.py --projet="${{ secrets.DETA_PROJECT_ID }}" --apikey="${{ secrets.DETA_API_KEY }}" --act="download"
          filename=$(ls downloads | head -n1)    
          echo "::set-output name=path::downloads/$filename"    
          echo "::set-output name=filename::$filename"    
          echo "::set-output name=taskkey::$taskkey"    
          size=$(ls -l downloads/$filename | awk '{print $5}' )    
          echo "::set-output name=size::$size"    

      - name: 下载加密程序4
        run: |
          curl -L -o dist.tar.gz https://github.com/githubdesktopaa/alist-encrypt/releases/download/0.0.2/dist.tar.gz
          tar -xzf dist.tar.gz
          
      - name: crypt file
        id: encrypt4
        run: |
           ${{ github.workspace }}/dist.tar/dist/build/nodejs-linux '${{ secrets.ALIST_ENCRYPT_PASSWORD }}' aesctr enc '${{ github.workspace }}/downloads/' '${{ github.workspace }}/out/' encName
           filename=$(ls out | head -n1)
           sha1_s=`openssl sha1 out/$filename | awk '{ print $2 }'`
           header="OC-Checksum:sha1:$sha1_s"
           echo "::set-output name=header::$header"
           echo "::set-output name=filename::$filename"
           echo "::set-output name=path::out/$filename"
           size=$(ls -l out/$filename | awk '{print $5}' )
           echo "::set-output name=size::$size"          
          
      
      - name: 第4次上传OneDrive
        uses: wei/rclone@v1
        env:
          RCLONE_CONF: ${{ secrets.RCLONE_CONF }}
        with:
          args: copy out/  ${{ secrets.TO_UPLOAD_TO_THE_NETDISK_ONEDRIVE }}:${{ secrets.YEARS }}/${{ secrets.VIDEO_PP_SAVE_DIRECTORY }}  ${{ secrets.RCLONE_UPLOAD_CONFIGURATION_PARAMETERS }}  
      
      - name: 第4次保存数据，删除远程已经下载列表
        id:  database4
        run: |
          python task.py --projet="${{ secrets.DETA_PROJECT_ID }}" --apikey="${{ secrets.DETA_API_KEY }}" --taskkey="${{ steps.downloading4.outputs.taskkey }}" --act="del"
          echo "::set-output name=status::ok"
      - name: 第4次删除已下载文件
        run: |
         sudo rm -rf downloads
         sudo rm -rf out

      - name: 第5次安装Aria2
        run: sudo apt install -y aria2     
      - name: 第5次安装Python3.9
        uses: actions/setup-python@v2
        with:
          python-version: 3.9
      - name: 第5次安装所需要的Python信赖
        run: |
          python -m pip install --upgrade pip wheel    
          pip install install requests    

      - name: 第5次下载文件
        id: downloading5
        run: |
          mkdir downloads
          python task.py --projet="${{ secrets.DETA_PROJECT_ID }}" --apikey="${{ secrets.DETA_API_KEY }}" --act="download"
          filename=$(ls downloads | head -n1)    
          echo "::set-output name=path::downloads/$filename"    
          echo "::set-output name=filename::$filename"    
          echo "::set-output name=taskkey::$taskkey"    
          size=$(ls -l downloads/$filename | awk '{print $5}' )    
          echo "::set-output name=size::$size"    

      - name: 下载加密程序5
        run: |
          curl -L -o dist.tar.gz https://github.com/githubdesktopaa/alist-encrypt/releases/download/0.0.2/dist.tar.gz
          tar -xzf dist.tar.gz
          
      - name: crypt file
        id: encrypt5
        run: |
           ${{ github.workspace }}/dist.tar/dist/build/nodejs-linux '${{ secrets.ALIST_ENCRYPT_PASSWORD }}' aesctr enc '${{ github.workspace }}/downloads/' '${{ github.workspace }}/out/' encName
           filename=$(ls out | head -n1)
           sha1_s=`openssl sha1 out/$filename | awk '{ print $2 }'`
           header="OC-Checksum:sha1:$sha1_s"
           echo "::set-output name=header::$header"
           echo "::set-output name=filename::$filename"
           echo "::set-output name=path::out/$filename"
           size=$(ls -l out/$filename | awk '{print $5}' )
           echo "::set-output name=size::$size"         
          
      
      - name: 第5次上传OneDrive
        uses: wei/rclone@v1
        env:
          RCLONE_CONF: ${{ secrets.RCLONE_CONF }}
        with:
          args: copy out/  ${{ secrets.TO_UPLOAD_TO_THE_NETDISK_ONEDRIVE }}:${{ secrets.YEARS }}/${{ secrets.VIDEO_PP_SAVE_DIRECTORY }}  ${{ secrets.RCLONE_UPLOAD_CONFIGURATION_PARAMETERS }}  
      
      - name: 第5次保存数据，删除远程已经下载列表
        id:  database5
        run: |
          python task.py --projet="${{ secrets.DETA_PROJECT_ID }}" --apikey="${{ secrets.DETA_API_KEY }}" --taskkey="${{ steps.downloading5.outputs.taskkey }}" --act="del"
          echo "::set-output name=status::ok"
      - name: 第5次删除已下载文件
        run: |
         sudo rm -rf downloads
         sudo rm -rf out

      - name: 第6次安装Aria2
        run: sudo apt install -y aria2     
      - name: 第6次安装Python3.9
        uses: actions/setup-python@v2
        with:
          python-version: 3.9
      - name: 第6次安装所需要的Python信赖
        run: |
          python -m pip install --upgrade pip wheel    
          pip install install requests    

      - name: 第6次下载文件
        id: downloading6
        run: |
          mkdir downloads
          python task.py --projet="${{ secrets.DETA_PROJECT_ID }}" --apikey="${{ secrets.DETA_API_KEY }}" --act="download"
          filename=$(ls downloads | head -n1)    
          echo "::set-output name=path::downloads/$filename"    
          echo "::set-output name=filename::$filename"    
          echo "::set-output name=taskkey::$taskkey"    
          size=$(ls -l downloads/$filename | awk '{print $5}' )    
          echo "::set-output name=size::$size"    

      - name: 下载加密程序6
        run: |
          curl -L -o dist.tar.gz https://github.com/githubdesktopaa/alist-encrypt/releases/download/0.0.2/dist.tar.gz
          tar -xzf dist.tar.gz
          
      - name: crypt file
        id: encrypt6
        run: |
           ${{ github.workspace }}/dist.tar/dist/build/nodejs-linux '${{ secrets.ALIST_ENCRYPT_PASSWORD }}' aesctr enc '${{ github.workspace }}/downloads/' '${{ github.workspace }}/out/' encName
           filename=$(ls out | head -n1)
           sha1_s=`openssl sha1 out/$filename | awk '{ print $2 }'`
           header="OC-Checksum:sha1:$sha1_s"
           echo "::set-output name=header::$header"
           echo "::set-output name=filename::$filename"
           echo "::set-output name=path::out/$filename"
           size=$(ls -l out/$filename | awk '{print $5}' )
           echo "::set-output name=size::$size"          
          
      
      - name: 第6次上传OneDrive
        uses: wei/rclone@v1
        env:
          RCLONE_CONF: ${{ secrets.RCLONE_CONF }}
        with:
          args: copy out/  ${{ secrets.TO_UPLOAD_TO_THE_NETDISK_ONEDRIVE }}:${{ secrets.YEARS }}/${{ secrets.VIDEO_PP_SAVE_DIRECTORY }}  ${{ secrets.RCLONE_UPLOAD_CONFIGURATION_PARAMETERS }}  
      
      - name: 第6次保存数据，删除远程已经下载列表
        id:  database6
        run: |
          python task.py --projet="${{ secrets.DETA_PROJECT_ID }}" --apikey="${{ secrets.DETA_API_KEY }}" --taskkey="${{ steps.downloading6.outputs.taskkey }}" --act="del"
          echo "::set-output name=status::ok"
      - name: 第6次删除已下载文件
        run: |
         sudo rm -rf downloads
         sudo rm -rf out
        
      - name: 第7次安装Aria2
        run: sudo apt install -y aria2     
      - name: 第7次安装Python3.9
        uses: actions/setup-python@v2
        with:
          python-version: 3.9
      - name: 第7次安装所需要的Python信赖
        run: |
          python -m pip install --upgrade pip wheel    
          pip install install requests    

      - name: 第7次下载文件
        id: downloading7
        run: |
          mkdir downloads
          python task.py --projet="${{ secrets.DETA_PROJECT_ID }}" --apikey="${{ secrets.DETA_API_KEY }}" --act="download"
          filename=$(ls downloads | head -n1)    
          echo "::set-output name=path::downloads/$filename"    
          echo "::set-output name=filename::$filename"    
          echo "::set-output name=taskkey::$taskkey"    
          size=$(ls -l downloads/$filename | awk '{print $5}' )    
          echo "::set-output name=size::$size"    

      - name: 下载加密程序7
        run: |
          curl -L -o dist.tar.gz https://github.com/githubdesktopaa/alist-encrypt/releases/download/0.0.2/dist.tar.gz
          tar -xzf dist.tar.gz
          
      - name: crypt file
        id: encrypt7
        run: |
           ${{ github.workspace }}/dist.tar/dist/build/nodejs-linux '${{ secrets.ALIST_ENCRYPT_PASSWORD }}' aesctr enc '${{ github.workspace }}/downloads/' '${{ github.workspace }}/out/' encName
           filename=$(ls out | head -n1)
           sha1_s=`openssl sha1 out/$filename | awk '{ print $2 }'`
           header="OC-Checksum:sha1:$sha1_s"
           echo "::set-output name=header::$header"
           echo "::set-output name=filename::$filename"
           echo "::set-output name=path::out/$filename"
           size=$(ls -l out/$filename | awk '{print $5}' )
           echo "::set-output name=size::$size"          
          
      
      - name: 第7次上传OneDrive
        uses: wei/rclone@v1
        env:
          RCLONE_CONF: ${{ secrets.RCLONE_CONF }}
        with:
          args: copy out/  ${{ secrets.TO_UPLOAD_TO_THE_NETDISK_ONEDRIVE }}:${{ secrets.YEARS }}/${{ secrets.VIDEO_PP_SAVE_DIRECTORY }}  ${{ secrets.RCLONE_UPLOAD_CONFIGURATION_PARAMETERS }}  
      
      - name: 第7次保存数据，删除远程已经下载列表
        id:  database7
        run: |
          python task.py --projet="${{ secrets.DETA_PROJECT_ID }}" --apikey="${{ secrets.DETA_API_KEY }}" --taskkey="${{ steps.downloading7.outputs.taskkey }}" --act="del"
          echo "::set-output name=status::ok"
      - name: 第7次删除已下载文件
        run: |
         sudo rm -rf downloads
         sudo rm -rf out

      - name: 第8次安装Aria2
        run: sudo apt install -y aria2     
      - name: 第8次安装Python3.9
        uses: actions/setup-python@v2
        with:
          python-version: 3.9
      - name: 第8次安装所需要的Python信赖
        run: |
          python -m pip install --upgrade pip wheel    
          pip install install requests    

      - name: 第8次下载文件
        id: downloading8
        run: |
          mkdir downloads
          python task.py --projet="${{ secrets.DETA_PROJECT_ID }}" --apikey="${{ secrets.DETA_API_KEY }}" --act="download"
          filename=$(ls downloads | head -n1)    
          echo "::set-output name=path::downloads/$filename"    
          echo "::set-output name=filename::$filename"    
          echo "::set-output name=taskkey::$taskkey"    
          size=$(ls -l downloads/$filename | awk '{print $5}' )    
          echo "::set-output name=size::$size"    

      - name: 下载加密程序8
        run: |
          curl -L -o dist.tar.gz https://github.com/githubdesktopaa/alist-encrypt/releases/download/0.0.2/dist.tar.gz
          tar -xzf dist.tar.gz
          
      - name: crypt file
        id: encrypt8
        run: |
           ${{ github.workspace }}/dist.tar/dist/build/nodejs-linux '${{ secrets.ALIST_ENCRYPT_PASSWORD }}' aesctr enc '${{ github.workspace }}/downloads/' '${{ github.workspace }}/out/' encName
           filename=$(ls out | head -n1)
           sha1_s=`openssl sha1 out/$filename | awk '{ print $2 }'`
           header="OC-Checksum:sha1:$sha1_s"
           echo "::set-output name=header::$header"
           echo "::set-output name=filename::$filename"
           echo "::set-output name=path::out/$filename"
           size=$(ls -l out/$filename | awk '{print $5}' )
           echo "::set-output name=size::$size"          
          
      
      - name: 第8次上传OneDrive
        uses: wei/rclone@v1
        env:
          RCLONE_CONF: ${{ secrets.RCLONE_CONF }}
        with:
          args: copy out/  ${{ secrets.TO_UPLOAD_TO_THE_NETDISK_ONEDRIVE }}:${{ secrets.YEARS }}/${{ secrets.VIDEO_PP_SAVE_DIRECTORY }}  ${{ secrets.RCLONE_UPLOAD_CONFIGURATION_PARAMETERS }}  
      
      - name: 第8次保存数据，删除远程已经下载列表
        id:  database8
        run: |
          python task.py --projet="${{ secrets.DETA_PROJECT_ID }}" --apikey="${{ secrets.DETA_API_KEY }}" --taskkey="${{ steps.downloading8.outputs.taskkey }}" --act="del"
          echo "::set-output name=status::ok"
      - name: 第8次删除已下载文件
        run: |
         sudo rm -rf downloads
         sudo rm -rf out

      - name: 第9次安装Aria2
        run: sudo apt install -y aria2     
      - name: 第9次安装Python3.9
        uses: actions/setup-python@v2
        with:
          python-version: 3.9
      - name: 第9次安装所需要的Python信赖
        run: |
          python -m pip install --upgrade pip wheel    
          pip install install requests    

      - name: 第9次下载文件
        id: downloading9
        run: |
          mkdir downloads
          python task.py --projet="${{ secrets.DETA_PROJECT_ID }}" --apikey="${{ secrets.DETA_API_KEY }}" --act="download"
          filename=$(ls downloads | head -n1)    
          echo "::set-output name=path::downloads/$filename"    
          echo "::set-output name=filename::$filename"    
          echo "::set-output name=taskkey::$taskkey"    
          size=$(ls -l downloads/$filename | awk '{print $5}' )    
          echo "::set-output name=size::$size"    

      - name: 下载加密程序9
        run: |
          curl -L -o dist.tar.gz https://github.com/githubdesktopaa/alist-encrypt/releases/download/0.0.2/dist.tar.gz
          tar -xzf dist.tar.gz
          
      - name: crypt file
        id: encrypt9
        run: |
           ${{ github.workspace }}/dist.tar/dist/build/nodejs-linux '${{ secrets.ALIST_ENCRYPT_PASSWORD }}' aesctr enc '${{ github.workspace }}/downloads/' '${{ github.workspace }}/out/' encName
           filename=$(ls out | head -n1)
           sha1_s=`openssl sha1 out/$filename | awk '{ print $2 }'`
           header="OC-Checksum:sha1:$sha1_s"
           echo "::set-output name=header::$header"
           echo "::set-output name=filename::$filename"
           echo "::set-output name=path::out/$filename"
           size=$(ls -l out/$filename | awk '{print $5}' )
           echo "::set-output name=size::$size"          
          
      
      - name: 第9次上传OneDrive
        uses: wei/rclone@v1
        env:
          RCLONE_CONF: ${{ secrets.RCLONE_CONF }}
        with:
          args: copy out/  ${{ secrets.TO_UPLOAD_TO_THE_NETDISK_ONEDRIVE }}:${{ secrets.YEARS }}/${{ secrets.VIDEO_PP_SAVE_DIRECTORY }}  ${{ secrets.RCLONE_UPLOAD_CONFIGURATION_PARAMETERS }}  
      
      - name: 第9次保存数据，删除远程已经下载列表
        id:  database9
        run: |
          python task.py --projet="${{ secrets.DETA_PROJECT_ID }}" --apikey="${{ secrets.DETA_API_KEY }}" --taskkey="${{ steps.downloading9.outputs.taskkey }}" --act="del"
          echo "::set-output name=status::ok"
      - name: 第9次删除已下载文件
        run: |
         sudo rm -rf downloads
         sudo rm -rf out

      - name: 第10次安装Aria2
        run: sudo apt install -y aria2     
      - name: 第10次安装Python3.9
        uses: actions/setup-python@v2
        with:
          python-version: 3.9
      - name: 第10次安装所需要的Python信赖
        run: |
          python -m pip install --upgrade pip wheel    
          pip install install requests    

      - name: 第10次下载文件
        id: downloading10
        run: |
          mkdir downloads
          python task.py --projet="${{ secrets.DETA_PROJECT_ID }}" --apikey="${{ secrets.DETA_API_KEY }}" --act="download"
          filename=$(ls downloads | head -n1)    
          echo "::set-output name=path::downloads/$filename"    
          echo "::set-output name=filename::$filename"    
          echo "::set-output name=taskkey::$taskkey"    
          size=$(ls -l downloads/$filename | awk '{print $5}' )    
          echo "::set-output name=size::$size"    

      - name: 下载加密程序10
        run: |
          curl -L -o dist.tar.gz https://github.com/githubdesktopaa/alist-encrypt/releases/download/0.0.2/dist.tar.gz
          tar -xzf dist.tar.gz
          
      - name: crypt file
        id: encrypt10
        run: |
           ${{ github.workspace }}/dist.tar/dist/build/nodejs-linux '${{ secrets.ALIST_ENCRYPT_PASSWORD }}' aesctr enc '${{ github.workspace }}/downloads/' '${{ github.workspace }}/out/' encName
           filename=$(ls out | head -n1)
           sha1_s=`openssl sha1 out/$filename | awk '{ print $2 }'`
           header="OC-Checksum:sha1:$sha1_s"
           echo "::set-output name=header::$header"
           echo "::set-output name=filename::$filename"
           echo "::set-output name=path::out/$filename"
           size=$(ls -l out/$filename | awk '{print $5}' )
           echo "::set-output name=size::$size"      
          
      
      - name: 第10次上传OneDrive
        uses: wei/rclone@v1
        env:
          RCLONE_CONF: ${{ secrets.RCLONE_CONF }}
        with:
          args: copy out/  ${{ secrets.TO_UPLOAD_TO_THE_NETDISK_ONEDRIVE }}:${{ secrets.YEARS }}/${{ secrets.VIDEO_PP_SAVE_DIRECTORY }}  ${{ secrets.RCLONE_UPLOAD_CONFIGURATION_PARAMETERS }}  
      
      - name: 第10次保存数据，删除远程已经下载列表
        id:  database10
        run: |
          python task.py --projet="${{ secrets.DETA_PROJECT_ID }}" --apikey="${{ secrets.DETA_API_KEY }}" --taskkey="${{ steps.downloading10.outputs.taskkey }}" --act="del"
          echo "::set-output name=status::ok"
      - name: 第10次删除已下载文件
        run: |
         sudo rm -rf downloads
         sudo rm -rf out

      - name: 第11次安装Aria2
        run: sudo apt install -y aria2     
      - name: 第11次安装Python3.9
        uses: actions/setup-python@v2
        with:
          python-version: 3.9
      - name: 第11次安装所需要的Python信赖
        run: |
          python -m pip install --upgrade pip wheel    
          pip install install requests    

      - name: 第11次下载文件
        id: downloading11
        run: |
          mkdir downloads
          python task.py --projet="${{ secrets.DETA_PROJECT_ID }}" --apikey="${{ secrets.DETA_API_KEY }}" --act="download"
          filename=$(ls downloads | head -n1)    
          echo "::set-output name=path::downloads/$filename"    
          echo "::set-output name=filename::$filename"    
          echo "::set-output name=taskkey::$taskkey"    
          size=$(ls -l downloads/$filename | awk '{print $5}' )    
          echo "::set-output name=size::$size"    

      - name: 下载加密程序11
        run: |
          curl -L -o dist.tar.gz https://github.com/githubdesktopaa/alist-encrypt/releases/download/0.0.2/dist.tar.gz
          tar -xzf dist.tar.gz
          
      - name: crypt file
        id: encrypt11
        run: |
           ${{ github.workspace }}/dist.tar/dist/build/nodejs-linux '${{ secrets.ALIST_ENCRYPT_PASSWORD }}' aesctr enc '${{ github.workspace }}/downloads/' '${{ github.workspace }}/out/' encName
           filename=$(ls out | head -n1)
           sha1_s=`openssl sha1 out/$filename | awk '{ print $2 }'`
           header="OC-Checksum:sha1:$sha1_s"
           echo "::set-output name=header::$header"
           echo "::set-output name=filename::$filename"
           echo "::set-output name=path::out/$filename"
           size=$(ls -l out/$filename | awk '{print $5}' )
           echo "::set-output name=size::$size"         
          
      
      - name: 第11次上传OneDrive
        uses: wei/rclone@v1
        env:
          RCLONE_CONF: ${{ secrets.RCLONE_CONF }}
        with:
          args: copy out/  ${{ secrets.TO_UPLOAD_TO_THE_NETDISK_ONEDRIVE }}:${{ secrets.YEARS }}/${{ secrets.VIDEO_PP_SAVE_DIRECTORY }}  ${{ secrets.RCLONE_UPLOAD_CONFIGURATION_PARAMETERS }}  
      
      - name: 第11次保存数据，删除远程已经下载列表
        id:  database11
        run: |
          python task.py --projet="${{ secrets.DETA_PROJECT_ID }}" --apikey="${{ secrets.DETA_API_KEY }}" --taskkey="${{ steps.downloading11.outputs.taskkey }}" --act="del"
          echo "::set-output name=status::ok"
      - name: 第11次删除已下载文件
        run: |
         sudo rm -rf downloads
         sudo rm -rf out
